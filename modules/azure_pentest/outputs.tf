output "resource_group_name" {
  description = "Name of the resource group"
  value       = azurerm_resource_group.pentest.name
}

output "vm_name" {
  description = "Name of the VM"
  value       = azurerm_linux_virtual_machine.pentest.name
}

output "vm_public_ip" {
  description = "Public IP address of the VM"
  value       = azurerm_public_ip.pentest.ip_address
}

output "vm_admin_username" {
  description = "Admin username for SSH"
  value       = var.admin_username
}

output "vm_principal_id" {
  description = "Principal ID of the VM's managed identity"
  value       = azurerm_linux_virtual_machine.pentest.identity[0].principal_id
}

output "subscription_id" {
  description = "Azure subscription ID"
  value       = data.azurerm_subscription.current.subscription_id
}

output "keyvault_name" {
  description = "Name of the Key Vault"
  value       = azurerm_key_vault.pentest.name
}

output "storage_account_name" {
  description = "Name of the storage account"
  value       = azurerm_storage_account.pentest.name
}

output "function_app_name" {
  description = "Name of the function app"
  value       = azurerm_linux_function_app.pentest.name
}

output "ssh_private_key_path" {
  description = "Path to the SSH private key"
  value       = local_file.private_key.filename
}

output "ssh_connection_command" {
  description = "SSH connection command"
  value       = "ssh -i ${local_file.private_key.filename} ${var.admin_username}@${azurerm_public_ip.pentest.ip_address}"
}

# Output for .env file content
output "env_file_content" {
  description = "Content for .env file"
  value       = <<-EOT
#=====Instructions=====

# Azure Penetration Testing Environment Variables
# This file contains the configuration needed for the Azure penetration tests.

#Ensure you have an Azure VM with:
#    - A Managed Identity (System-assigned or User-assigned) with appropriate permissions
#    - SSH access enabled (port 22 open in NSG)
#    - The SSH private key saved as azure_attack.pem in this directory


#=====SSH Connection Settings=====

# Path to the SSH private key for the target VM
SSH_KEY_PATH=${local_file.private_key.filename}
# Public IP address of the target Azure VM
AZURE_VM_PUBLIC_IP=${azurerm_public_ip.pentest.ip_address}
# SSH username for the target VM (default: azureuser)
AZURE_VM_USERNAME=${var.admin_username}

#=====Azure Environment Settings=====

# Azure Subscription ID where the target resources are located
AZURE_SUBSCRIPTION_ID=${data.azurerm_subscription.current.subscription_id}
# Azure Resource Group name where the target VM is located
AZURE_RESOURCE_GROUP=${azurerm_resource_group.pentest.name}
# Name of the target Azure VM
AZURE_VM_NAME=${azurerm_linux_virtual_machine.pentest.name}


#=====Penetration Tests Resources=====

#keyvault_config_attack
KEYVAULT_NAME=${azurerm_key_vault.pentest.name}
#storage_keys_attack
STORAGE_ACCOUNT_NAME=${azurerm_storage_account.pentest.name}
#function_app_config_attack
FUNCTION_APP_NAME=${azurerm_linux_function_app.pentest.name}
#role_assignment_attack
TARGET_PRINCIPAL_ID=${azuread_service_principal.target_sp.object_id}
EOT
}
